---
layout: presentation
title: Sources
lesson: 106
estimated_teaching_time: 30
teaching_method: live demo + slides. Questions encouraged.
working_session: true
---

class: title, center, middle
# Sources

---

# If any of the following is true...

* I'm switching my email marketing platform. (Or: I'm switching the tool that
extracts and loads _from_ my email marketing platform.) I want to know which
final models depend on that source data.
--

* I'm switching from Redshift to Snowflake. All of my source data will be
in a different database/schema.
--

* Because no one is perfect, my data loading tools experience occasional
hiccups or wrinkles that result in delayed or duplicated data
--

* My SQL transformations are working as expected, but my transformed data just
doesn't look right. Help?!?!
--

* I want to stage & query data that lives in external file storage (!!)

---

# Sources may be right for you!

* Declare `database`, `schema`, and `table` names
* Test schema integrity (`unique`, `not_null`)
* Test loading freshness
* Declare `external` properties

---

# Familiar concepts

I define my sources in `stripe_source.yml`:
```yml
version: 2

sources:
  - name: stripe
    tables:
      - name: payment
```

And then I create a staging model, `stg_stripe_payment.sql`:

{% raw %}
```sql
with source as (

    select * from {{source('stripe', 'payment')}}

),

renamed as (

...
```
{% endraw %}

---

# Sources are green...

<img src="/lessons/img/{{page.lesson}}/dag-source.png" class="img-center">

---

# And green is good

```yml
sources:
  - name: stripe
    loaded_at_field: _batched_at
    loader: airflow
    
    freshness:
      warn_after: {count: 12, period: hour}
      error_after: {count: 24, period: hour}
    
    tables:
      - name: payment
```

<img src="/lessons/img/{{page.lesson}}/freshness-viz.png" class="img-center">

---

# A common approach

```bash
dbt test -m source:*            # ensure no duplicates or unexpected nulls
dbt run                         # only runs if test above succeeds
dbt test --exclude source:*
dbt source snapshot-freshness
```

---

name: working-session
class: subtitle

# Working session
* Add `sources` for our two data sources: `jaffle_shop` and `stripe`.

{% include options/next-presentation.html %}
