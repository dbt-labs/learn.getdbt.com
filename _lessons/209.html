---
layout: presentation
title: End to end case study
lesson: 203
---
# Designing a data model
???
Teacher notes:
* This is a real life case study from Slack

Speaker track:
* We recently started putting all of our data from Slack into Snowflake, so we're taking you through what that looked like.
* I was both the stakeholder and the analyst
* Emphasis on the word "design" — a ton of consideration for our end user
---
# Process of modeling
1. Define the model
2. Exploratory model building
3. Refactor
---
# 1. Define the model
---
# Start at the finish:
* What’s the business question I’m trying to answer?
* What data questions do they translate to?
* What is the dashboard I’m trying to build?
* What other questions will business  users have when they see this dashboard? How will they want to slice and dice the data?
* What is the granularity of the model?
* What fields do I need on my model?

---

# Case study:
**What’s the business question I’m trying to answer?**
How active is our dbt Slack community?

**What is the dashboard I'm trying to build?**
Let's draw it!

???
[to do for future Learn's that i'm not part of, insert image here!]
---
# Case study
**What other questions will business users have when they see this dashboard?**
--
* How many messages get sent a day? Should that number include replies?
* How many messages get a reply? How quickly? Wait, replies can’t get replies… so we need to filter those out
* How many replies does a message get?
* Who is posting the most?
* What channels are the most active?

---
# Case study
**What is the granularity of the model? What fields do I need?**
--
.left-column[
`f_posts`: One record per message that is posted in a channel
* message_id
* user_id (user handle?)
* posted_at
* n_replies
* first_reply_at
* channel_id
]

.right-column[
`f_replies`: One record per message that is posted in reply to another message
* message_id
* user_id
* parent_message_id
]
---
# Hold up!
???
Do we need to build this model (in this case yes, because it's a new data source)
--
* Can we adjust an existing model rather than create a new one?
* Does this belong in dbt or in the BI layer?
* Is this an ad-hoc request, or something that is worth spending time on?

---
# Exploratory model building
---
# Work backwards to the {{ source() }}
* What data to I have available to fill in the blanks?
  * Now is the time to interrogate your data.
* How does the data join together? Do I have the right keys to join across?
* What assumptions am I making about my data sources? Can I test those?

---
layout:false
<img src="/lessons/img/{{page.lesson}}/exploratory-data-analysis.png" style="width: 100%;">
---
# Case study
What data do I have?
* `raw.slack.messages`: Data source that gets updated daily
* `raw.slack_historical.messages`: Historical message export
Great let’s draw a DAG & write a few models!
???
To-do:
Insert a picture of fake dag into
---
# Write V1 of the model
* Start by putting all your code in one or a few SQL files! (but use CTEs)
* Develop your dashboard at the same time to check the results
* What other “sources of truth” do you have for this data? Does your model match?
* Is it perfect? (Does it need to be?)
Then `git commit!`
---
# Case study
**Things discovered while building this model:**
* Timestamps are in epoch?
* No primary key? The epoch timestamp is the primary key?
* Different column names in historical? Only a channel_name, not an id?
* Different grains — nested replies?
* Messages includes channel joins!
---
# Refactor
---
# As you go, consider:
* Modularity:
    * Am I repeating SQL? Can I re-use models already in my project?
    * Am I mixing cleansing and business logic?
* Performance
    * Is my final model fast to query? Is it fast to build?
    * Simplicity/Abstraction
    * Can I make this code easier to understand?
* Correctness:
    * How correct is this? Does that matter?
---
to-do: final dag
---
# Final checklist:
Before you send a PR to be reviewed, check whether you have:
* Have I used sources?
* Have I materialized my models appropriately?
* Does my code match the style guide?
* Do I have tests and descriptions?
(Check out our [checklist](https://github.com/fishtown-analytics/dbt-init/blob/master/starter-project/.github/pull_request_template.md))
